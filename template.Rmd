---
title: "Untitled"
author: "Pierre Tocquin"
date: "10 mars 2016"
output:
  pdf_document:
      fig_caption: yes
bibliography: biblio_TP-1.bib
---

```{r libraries, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}
# Installation d'une librairie pour la production de graphiques`
# install.packages("ggplot2")
library(ggplot2)
# Installation d'une librairie pour la gestion des données tabulaires
# install.packages("data.table")
library(data.table)
```

# Introduction

L'introduction contient les éléments, étayés par la littérature scientifique, qui supportent la ou les hypothèses que vous allez évaluer par votre expérimentation. A ce titre, toute information doit être reliée à sa source, c'est à dire à une référence bibliographique.

Ceci est une référence à 2 publications [@folta_light_2008; @symons_interactions_2003]

**Votre introduction sera concise mais devra permettre à ceux qui la lisent de comprendre (1) le contexte de votre travail, (2) les éléments concrets sur lesquels vous vous appuyez et qui vous amènent à (3) élaborer votre question/hypothèse.**

# Matériel et méthodes

Cette section décrit les conditions de votre expérimentation, ainsi que le matériel utilisé. L'idée générale est que, sur bases des informations fournies, il soit possible de reproduire exactement votre expérience. 

**Utilisez toujours un style concis ! Pas de bla-bla ! Voici des exemples extraits de [@jensen_auxin_1998] :**

> Arabidopsis thaliana seeds were surface sterilized for 20 min in 20% (v/v) commercial bleach and 0.1% Triton X-100, rinsed four times with sterile, distilled water, and chilled for 2 d at 4°C. Sterile seeds were placed in square Petri plates on medium containing nutrient salts, 8 g/L 1 agar, and 10 g/L 1 Suc (Lincoln et al., 1990). ... All plants were ecotype Columbia unless stated otherwise. Petri plates were placed vertically and the seed- lings were grown at 22°C in darkness or in continuous light for 7 d. In experiments with the photoreceptor mutants, the seeds were given 16 h of white light to ensure germination before placement in the experimental light conditions. Seeds of the mutants analyzed in this study were obtained from in-house stocks or from the Arabidopsis Biological Resource Center (Ohio State University, Columbus). ...

> **Light Sources**

> White light at up to 150 mol.m^-2^ s^-1^ was obtained with mixed cool-white and warm-fluorescent light bulbs. Blue light up to 30 mol.m^-2^ s^-1^ was obtained by filtering light from a bank of cool-white fluorescent bulbs through blue plexiglass (no. 2424, Rohm and Hass, Darmstadt, Germany). Red and far-red light up to 30 mol.m^-2^ s^-1^ was provided by a solid-state light-emitting diode system (Qbeam 220, Quantum Devices, Barnevel, WI). Neutral- density screens were used to vary the fluence rates. Fluence rates of white, blue, and red light were measured with a quantum photometer (model LI-189, Li-Cor, Lincoln, NE) and fluence rates of far-red light were measured with a spectroradiometer (model LI-1800, Li-Cor).

# Résultats

```{r load_data, echo=FALSE, eval=TRUE}
# Lecture des données csv, méthode de r-base
# data1 <- read.table(file = "student1/resulat.csv", header = TRUE, sep = ",")
# data2 <- read.table(file = "student2/Donneesgravitropisme - Copie.csv", header = TRUE, sep = ";")

# Lecture des données csv, méthode data.table
data1 <- fread(input = "student1/resulat.csv")
data2 <- fread(input = "student2/gravi.csv")
```


```{r data1, echo=FALSE}
## Mise en forme des données, méthode r-base ######################################################
## Calcul de la différence de longueur entre le jour 0 et le jour 1
# difference  <- aggregate(longueur ~ plante + lumière, data1, "diff")

## Calcul de le moyenne et de l'écart-type de ces nouvelles données
# sd             <- aggregate(longueur ~ lumière, difference, "sd")
# colnames(sd)   <- c("lumière", "sd") # renommage des colonnes pour faciliter le 'merge' à venir
# mean           <- aggregate(longueur ~ lumière, difference, "mean")
# colnames(mean) <- c("lumière", "mean") # renommage des colonnes pour faciliter le 'merge' à venir

## Création du tableau de synthèse moyenne & écart-type pour chaque condition de lumière
## Les 2 tableaux à 'merger' ont une seule colonne en commun ('lumière'), la commande 'merge'
## fonctionne donc de manière automatique en sélectionnant cette colonne pour fusionner les
## 2 tableaux
# data1.summarized <- merge(mean, sd)
# head(data1.summarized)

# Mise en forme des données, méthode data.table ###################################################
data1.summarized <- data1[,
                          list(diff=longueur[jour==1]-longueur[jour==0]),
                          by=list(plante, lumière)][, 
                                                    list(mean=mean(diff), sd=sd(diff)),
                                                    by=lumière]

data2.summarized <- data2[time == 1,
                          list(direction=mean(angle-180), ecarttype=sd(angle-180)),
                          by=list(Position, NPA)]
```

Le document comporte des exemples de figures que vous pouvez réaliser grâce au package `ggplot2`. Les codes vous sont fournis pour que vous puissiez vous en inspirer.

```{r fig1_data2, echo=FALSE, fig.height=3, fig.width=5, fig.cap="**Le Titre de ma figure 1**. Les éléments complémentaires pour comprendre ma figure 1. Parfois tout un paragraphe... qui peut être très long et qui permet à la figure d'être *auto-portante*..."}
## Mise en forme des données, méthode r-base ######################################################
## Calcul de la direction de croissance au jour 1 et en fonction du traitement NPA et du stimulus
# bending.mean  <- aggregate(angle-180 ~ Position + NPA, data2[data2$time == 1,], "mean")
# colnames(bending.mean) <- c("Position", "NPA", "mean")
# bending.sd  <- aggregate(angle-180 ~ Position + NPA, data2[data2$time == 1,], "sd")
# colnames(bending.sd) <- c("Position", "NPA", "sd")
# 
# bending <- merge(bending.mean, bending.sd)

bending <- data2[time == 1, 
                 list(mean=mean(angle-180), sd=sd(angle-180)),
                 by=list(Position, NPA)]

# Définition des paramètres principaux du graphique
g  <- ggplot(data = bending, mapping = aes(x = Position, y = mean, fill = NPA))

# Création du graphique
g.basic <- g + 
  geom_errorbar(width=.25, aes(ymin=mean-sd, ymax=mean),  # ajout des écart-types
                position=position_dodge(.9)) + # re-positionnement correct des barres d'erreur
  geom_bar(stat = "identity", position = position_dodge(), color = "black") # choix d'un barplot

# g.basic

# Amélioration du graphique
g.improved <- g.basic +
  scale_fill_manual(values = c("deepskyblue", "orange")) + # re-définition des couleurs des barres
  scale_x_discrete(labels=c("90°", "0°")) + # re-définition des étiquettes de l'axe x
  ylab("Direction de croissance \npar rapport à l'axe vertical (°)") + # Titre axe y
  xlab("Orientation de la boîte (°)")# Titre axe x

g.improved
```

Cette partie est descriptive: vous y décrivez vos résulats **sans les discuter**. Chaque tableau ou chaque graphique y est analysé **complètement** en y faisant référence. Par exemple, vous écrirez :

*"On observe sur la Figure 1 que, en absence de NPA, le pivotement de la boîte à 90° provoque une courbure moyenne de `r format(bending[bending$position == "Courbe" & bending$NPA == "Sans", "mean"], digits = 0)`°, mesurée après 24h, alors qu'elle est moindre (`r format(bending[bending$Position == "Debout" & bending$NPA == "Sans", "mean"], digits = 0)`°), comme attendu, dans la condition témoin. L'ajout de NPA dans le milieu inhibe  cette courbure qui n'est plus que de `r format(bending[bending$Position == "Courbe" & bending$NPA == "Avec", "mean"], digits = 0)`° pour les plantes subissant le stimulus gravitropique et `r format(bending[bending$Position == "Debout" & bending$NPA == "Avec", "mean"], digits = 0)`° pour les témoins."*

et non :

*"On observe sur la Figure 1 que le NPA inhibe le transport de l'auxine et empêche la racine de répondre au stimulus gravitropique."*

En effet, vous n'observez pas que le NPA inhibe le transport de l'auxine (c'est au contraire un élément connu de votre hypothèse), mais vous en observez les effets. Par ailleurs, cette dernière description n'assiste pas le lecteur dans le décriptage de la Figure 1...

Les figures 2 et 3 ci-après vous donnent d'autres exemples et codes de graphiques.

```{r fig2_data1, echo=FALSE, fig.height=3, fig.width=5, fig.cap="**Le Titre de ma figure 2**. Les éléments complémentaires pour comprendre ma figure 2. Parfois tout un paragraphe... qui peut être très long et qui permet à la figure d'être *auto-portante*..."}
# Définition des paramètres principaux du graphique
g  <- ggplot(data = data1.summarized, mapping = aes(x = lumière, y = mean, fill = lumière))

# Création du graphique de type 'barplot'
g.basic <- g + 
  geom_bar(stat = "identity", position = position_dodge()) + # choix d'un barplot
  geom_errorbar(width=.25, aes(ymin=mean-sd, ymax=mean+sd)) # ajout des écart-types

# Amélioration du graphique
g.improved <- g.basic +
  scale_fill_manual(values = c("white","blue", "black", "red", "darkred")) + # re-définition des couleurs des barres
  scale_x_discrete(labels=c("Blanc", "450nm", "Obscurité", "660nm", "750nm")) + # re-définition des étiquettes de l'axe x
  ylab("Croissance (cm/jour)") + # Titre axe y
  xlab("Conditions lumineuses") + # Titre axe x
  guides(fill=FALSE) # Suppression de la légende

g.improved
```

```{r fig3_data1, echo=FALSE, fig.height=3, fig.width=5, fig.cap="**Le Titre de ma figure 3**. Les éléments complémentaires pour comprendre ma figure 3. Parfois tout un paragraphe... qui peut être très long et qui permet à la figure d'être *auto-portante*..."}
# Mise en forme des données
## Calcul de la moyenne de longueur pour chaque jour et condition lumineuse
data.per.day <- data1[,
                      list(mean=mean(longueur), sd=sd(longueur)),
                      by=list(jour, lumière)]

# Définition des paramètres principaux du graphique
g  <- ggplot(data = data.per.day, mapping = aes(x = jour, y = mean, color = lumière))

# Création du graphique de type 'X-Y, lignes'
g.basic <- g + 
  geom_line() + # choix d'un graphique x/y de type ligne
  geom_errorbar(width=.05, aes(ymin=mean-sd, ymax=mean+sd)) # ajout des écart-types

# Amélioration du graphique
g.improved <- g.basic +
  scale_color_manual(values = c("white","blue", "black", "red", "darkred")) + # re-définition des couleurs des barres
  scale_x_continuous(breaks = c(0,1)) + # re-définition des étiquettes de l'axe x
  ylab("Croissance (cm/jour)") + # Titre axe y
  xlab("Jours")

g.improved
```


```{r fig1_data3, echo=FALSE, fig.height=3, fig.width=5, fig.cap="**Le Titre de ma figure**. Les éléments complémentaires pour comprendre ma figure. Parfois tout un paragraphe... qui peut être très long et qui permet à la figure d'être *auto-portante*..."}
data3   <- fread(input = "student3/data.csv")
data3$stimulus <- factor(data3$stimulus)  # transformation de cette donnée en 'facteurs' pour qu'elle soit
                                          # comprise par ggplot comme un paramètre de regroupement des données

# Définition des paramètres principaux du graphique
# Notez ici l'utilisation de l'argument 'group'
g  <- ggplot(data = data3, mapping = aes(x = stimulus, y = mean, fill = traitement, group = traitement))

# Création du graphique
g.basic <- g + 
  geom_errorbar(width=.25, aes(ymin=mean, ymax=mean+sd),  # ajout des écart-types
                position=position_dodge(.9)) + # re-positionnement correct des barres d'erreur
  geom_bar(stat = "identity", position = position_dodge(0.9), color = "black") # choix d'un barplot

# Séparation du graphique en 2 panneaux sur base du génotype
g.facet <- g.basic +
  facet_grid(. ~ genotype, labeller = labeller(genotype = c(GUS = "WT", PIN = "pin3-4"))) # la paramètre labeller sert au renommage

# Amélioration du graphique
g.improved <- g.facet +
  scale_fill_manual(values = c("blue","red"), name = "Traitement", labels = c("-NPA", "+NPA")) + # paramètres légende
  scale_x_discrete(labels=c("90°C", "0°C")) + # re-définition des étiquettes de l'axe x
  ylab("Courbure (°)") + # Titre axe y
  xlab("Orientation de la boîte (°)") # 

g.improved
```


```{r fig1_data4, echo=FALSE, fig.height=3, fig.width=5, fig.cap="**Le Titre de ma figure**. Les éléments complémentaires pour comprendre ma figure. Parfois tout un paragraphe... qui peut être très long et qui permet à la figure d'être *auto-portante*..."}
# Il est parfois nécessaire de fixer le type des colonnes qui servent à trier 
# ou regrouper les données sur 'factor'.
# dans le cas présent si vous ne faites pas cela pour la colonne 'stimulus', elle ne pourra pas vous
# servir à paramètrer la couleur des points via l'argument 'fill' de ggplot.
# Une façon de faire est de fixer le type de colonne lors de la lecture 'fread' à l'aide de
# l'argument 'colClasses'
# Notez que ggplot2 considère automatiquement les types 'string' comme des facteurs, raison pour laquelle,
# dans le cas présent, le problème se pose uniquement pour la colonne 'stimulus' dont les valeurs 0 et 90
# sont considérés comme des 'numeric' (ce qu'ils sont) et non automatiquement interprétés comme des facteurs
# par ggplot2.
data4   <- fread(input = "student3/fulldata.csv", colClasses = c("factor", "factor", "factor", "factor", "numeric"))

# Définition des paramètres principaux du graphique
# Notez ici l'utilisation de l'argument 'group'
g  <- ggplot(data = data4, mapping = aes(x = stimulus, y = angle, fill = stimulus))

# Création du graphique
g.basic <- g + 
  geom_dotplot(binaxis = "y", stackdir = "center", binwidth = 7) 

# Séparation du graphique en panneaux sur base du génotype et du traitement
g.facet <- g.basic +
  facet_grid(. ~ Genotype + traitement, labeller = labeller(Genotype = c(GUS = "WT", PIN = "pin3-4"))) # la paramètre labeller sert au renommage

# Amélioration du graphique
g.improved <- g.facet +
  scale_x_discrete(labels=c("90°C", "0°C")) + # re-définition des étiquettes de l'axe x
  ylab("Courbure (°)") + # Titre axe y
  xlab("Orientation de la boîte (°)") + # Titre axe x
  guides(fill=FALSE) # Suppression de la légende

g.improved
```

# Discussion et conclusion

Dans cette partie, vous rappelez brièvement votre hypothèse et faites la synthèse des observations. En intégrant vos différentes observations et en les reliant à ce que vous connaissez de la littérature, vous pouvez élaborer une discussion (attention, pas de bla-bla, quantité != qualité) et une conclusion. 

**N'essayez jamais de faire dire à une expérience ce qu'elle ne peut pas vous dire, imaginez plutôt ce qu'il faudrait faire pour aller plus loin.**


# Références

**Ce dernier titre est placé tout à la fin de votre document de sorte que `R` y insère automatiquement les références que vous avez citées dans votre texte.**















